<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;min-height:100vh;background:radial-gradient(1200px 800px at 10% -10%,#0b122a 0%,rgba(2,6,23,0) 60%),radial-gradient(1200px 800px at 110% 10%,#0f1b44 0%,rgba(2,6,23,0) 50%),linear-gradient(120deg,#0b1020 0%,#0b122a 100%);overflow-x:hidden;width:100vw;max-width:100vw}
    .wrap{width:100%;max-width:100vw;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;position:relative;box-sizing:border-box;overflow-x:hidden}
    .card{background:linear-gradient(180deg,rgba(2,6,23,.75),rgba(2,6,23,.45));border:1px solid transparent;border-radius:16px;box-shadow:0 16px 50px rgba(2,6,23,.5);width:100%;max-width:460px;padding:60px 40px;color:#e2e8f0;backdrop-filter:blur(8px);position:relative;z-index:2;box-sizing:border-box;overflow-x:hidden}
    @media (max-width: 768px){
      .wrap{padding:12px;justify-content:center;min-height:100vh;overflow:hidden;max-width:100vw;width:100vw}
      .card{padding:20px 16px;max-width:calc(100vw - 24px);width:calc(100vw - 24px);box-sizing:border-box;overflow-x:hidden}
      h1{font-size:20px;margin-bottom:4px;word-wrap:break-word;overflow-wrap:break-word}
      .sub{font-size:13px;margin-bottom:8px;word-wrap:break-word;overflow-wrap:break-word}
      .field{margin-bottom:8px}
      input{padding:8px;font-size:16px;box-sizing:border-box;width:100%;max-width:100%}
      .btn{padding:8px 16px;font-size:14px;margin-top:4px;box-sizing:border-box;width:100%;max-width:100%}
      .or{margin:8px 0;font-size:11px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
      .social{grid-template-columns:1fr 1fr;gap:6px;width:100%}
      .social button{padding:6px 8px;font-size:11px;box-sizing:border-box;width:100%;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .link{margin-top:8px;font-size:11px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
    }
    @media (max-width: 480px){
      .wrap{padding:8px;overflow:hidden;max-width:100vw;width:100vw}
      .card{padding:16px 12px;max-width:calc(100vw - 16px);width:calc(100vw - 16px);box-sizing:border-box;overflow-x:hidden}
      h1{font-size:18px;margin-bottom:3px;word-wrap:break-word;overflow-wrap:break-word}
      .sub{font-size:12px;margin-bottom:6px;word-wrap:break-word;overflow-wrap:break-word}
      .field{margin-bottom:6px}
      input{padding:6px;font-size:16px;box-sizing:border-box;width:100%;max-width:100%}
      .btn{padding:6px 12px;font-size:13px;margin-top:3px;box-sizing:border-box;width:100%;max-width:100%}
      .or{margin:6px 0;font-size:10px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
      .social{grid-template-columns:1fr;gap:4px;width:100%}
      .social button{padding:5px 6px;font-size:10px;box-sizing:border-box;width:100%;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .link{margin-top:6px;font-size:10px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
    }
    @media (max-width: 360px){
      .wrap{padding:6px;overflow:hidden;max-width:100vw;width:100vw}
      .card{padding:12px 8px;max-width:calc(100vw - 12px);width:calc(100vw - 12px);box-sizing:border-box;overflow-x:hidden}
      h1{font-size:16px;margin-bottom:2px;word-wrap:break-word;overflow-wrap:break-word}
      .sub{font-size:11px;margin-bottom:4px;word-wrap:break-word;overflow-wrap:break-word}
      .field{margin-bottom:4px}
      input{padding:4px;font-size:16px;box-sizing:border-box;width:100%;max-width:100%}
      .btn{padding:4px 8px;font-size:12px;margin-top:2px;box-sizing:border-box;width:100%;max-width:100%}
      .or{margin:4px 0;font-size:9px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
      .social{grid-template-columns:1fr;gap:3px;width:100%}
      .social button{padding:3px 4px;font-size:9px;box-sizing:border-box;width:100%;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .link{margin-top:4px;font-size:9px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
    }
    @media (max-width: 320px){
      .wrap{padding:4px;overflow:hidden;max-width:100vw;width:100vw}
      .card{padding:10px 6px;max-width:calc(100vw - 8px);width:calc(100vw - 8px);box-sizing:border-box;overflow-x:hidden}
      h1{font-size:14px;margin-bottom:1px;word-wrap:break-word;overflow-wrap:break-word}
      .sub{font-size:10px;margin-bottom:3px;word-wrap:break-word;overflow-wrap:break-word}
      .field{margin-bottom:3px}
      input{padding:3px;font-size:16px;box-sizing:border-box;width:100%;max-width:100%}
      .btn{padding:3px 6px;font-size:11px;margin-top:1px;box-sizing:border-box;width:100%;max-width:100%}
      .or{margin:3px 0;font-size:8px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
      .social{grid-template-columns:1fr;gap:2px;width:100%}
      .social button{padding:2px 3px;font-size:8px;box-sizing:border-box;width:100%;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .link{margin-top:3px;font-size:8px;text-align:center;word-wrap:break-word;overflow-wrap:break-word}
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    h1{margin:0 0 8px;font-size:22px}
    .sub{color:#a5b4fc;margin:0 0 16px}
    .field{margin-bottom:12px}
    label{display:block;margin:0 0 6px;color:#cbd5e1;font-weight:600;font-size:14px}
    input{width:100%;padding:12px;border:2px solid rgba(148,163,184,.25);border-radius:8px;font-size:14px;outline:none;box-sizing:border-box;background:rgba(15,23,42,.6);color:#e2e8f0}
    input:focus{border-color:#60a5fa}
    .btn{width:100%;padding:12px 16px;border:none;border-radius:10px;background:linear-gradient(135deg,#6366f1 0%,#3b82f6 60%,#06b6d4 120%);box-shadow:0 12px 30px rgba(6,182,212,.25);color:#fff;font-weight:800;letter-spacing:.02em;cursor:pointer;margin-top:8px}
    .err{color:#ef4444;font-size:13px;margin:8px 0 0}
    .link{margin-top:12px;font-size:13px;color:#94a3b8;text-align:center}
    .link a{color:#60a5fa;text-decoration:none}
    .link a:hover{text-decoration:underline}
    .or{display:flex;align-items:center;gap:10px;color:#94a3b8;font-size:12px;margin:12px 0}
    .or:before,.or:after{content:'';flex:1;height:1px;background:rgba(148,163,184,.25)}
    .social{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .social button{border:1px solid rgba(148,163,184,.25);border-radius:10px;padding:10px 12px;background:rgba(15,23,42,.6);cursor:pointer;font-weight:700;color:#e5e7eb;display:flex;align-items:center;gap:8px}
  </style>
  <script>
    async function doLogin(e){
      e.preventDefault();
      const username=document.getElementById('u').value.trim();
      const password=document.getElementById('p').value.trim();
      const err=document.getElementById('err');
      err.textContent='';
      if(!username||!password){err.textContent='Enter username and password';return}
      try{
        const r=await fetch('/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
        const d=await r.json();
        if(!d.success){ err.textContent=d.message||'Login failed'; return; }
        localStorage.setItem('token',d.token);
        localStorage.setItem('username',d.username);
        const role = (d && d.role) ? String(d.role) : 'user';
        if(role === 'subadmin'){ location.href='/dashboard?token=' + encodeURIComponent(d.token); return; }
        try{
          const cfg = await fetch('/get_company_config?username=' + encodeURIComponent(d.username), { headers: { 'Authorization': 'Bearer ' + d.token }});
          if(cfg.status === 404){ location.href = '/setup?token=' + encodeURIComponent(d.token); }
          else { location.href = '/dashboard?token=' + encodeURIComponent(d.token); }
        } catch(_){ location.href = '/dashboard?token=' + encodeURIComponent(d.token); }
      }catch(e){ err.textContent='Network error: ' + e.message; }
    }
    function loginGoogle(){ window.location.href='/auth/google'; }
    function loginFacebook(){ window.location.href='/auth/facebook'; }
  </script>
  </head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Sign in</h1>
      <p class="sub">Use your account to continue</p>
      <form onsubmit="doLogin(event)">
        <div class="field">
          <label>Username</label>
          <input id="u" placeholder="yourname" />
        </div>
        <div class="field">
          <label>Password</label>
          <input id="p" type="password" placeholder="••••••••" />
        </div>
        <button class="btn" type="submit">Continue</button>
        <div id="err" class="err"></div>
      </form>
      <div class="or">or continue with</div>
      <div class="social">
        <button type="button" onclick="loginGoogle()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21.35 11.1h-9.18v2.96h5.3c-.23 1.5-1.6 4.4-5.3 4.4-3.19 0-5.8-2.64-5.8-5.9s2.6-5.9 5.8-5.9c1.82 0 3.04.77 3.74 1.44l2.55-2.46C17.4 4.2 15.07 3 12.17 3 6.97 3 2.8 7.18 2.8 12.36c0 5.18 4.17 9.36 9.37 9.36 5.4 0 8.97-3.8 8.97-9.16 0-.62-.07-1.08-.18-1.46z" fill="#e5e7eb"/></svg> Google</button>
        <button type="button" onclick="loginFacebook()"><svg width="18" height="18" viewBox="0 0 24 24" fill="#1877F2"><path d="M22.675 0h-21.35C.595 0 0 .594 0 1.326v21.348C0 23.406.595 24 1.325 24h11.495v-9.294H9.691V11.01h3.129V8.41c0-3.1 1.894-4.788 4.659-4.788 1.325 0 2.463.099 2.794.143v3.24l-1.918.001c-1.504 0-1.796.715-1.796 1.763v2.313h3.587l-.467 3.696h-3.12V24h6.116C23.406 24 24 23.406 24 22.674V1.326C24 .594 23.406 0 22.675 0z"/></svg> Facebook</button>
      </div>
      <div class="link">Don't have an account? <a href="/signup">Sign up</a></div>
    </div>
  </div>
</body>
</html>


